<!DOCTYPE html>
<meta charset="utf-8">
<style>

.links line {
  stroke: #999;
  stroke-opacity: 0.6;
}

.nodes circle {
  stroke: #fff;
  stroke-width: 1.5px;
}

.ticks {
  font: 10px sans-serif;
}

#slider {
  width: 960;
}


</style>
<svg width="960" height="600"></svg>
<div>
  <input type="range" min="1" max="200" value="1" id="slider" onmouseup="newForceGraph()">
  <output id="output"></output>
</div>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="forceGraph.js"></script>
<script>

var fg; 

function draw(data){
  fg = new forceGraph(data);
}

d3.queue()
   .defer(d3.csv, 'comm-data-Fri.csv')
   .await(function(error, data) {
      if(error) throw error;  
      draw(data);
});

document.getElementById("output").value = document.getElementById("slider").value;

var svg = d3.select("svg"),
    margin = {right: 50, left: 50}, 
    width = +svg.attr("width"),
    height = +svg.attr("height");


// The colors for each park region
const colors = ['#000000', '#fe0304', '#dbeef4', '#c4d59f', '#d99591', '#fff3cb'];
const colorPlaces = ["External" ,'Entry Corridor', 'Tundra Land', 'Wet Land', 'Coaster Alley', 'Kiddie Land']

// To be filled with data with senders and recievers 
let uniqObj = {};

var simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(function(d) { return d.id; }))
    .force("charge", d3.forceManyBody())
    .force("center", d3.forceCenter(width / 2, height / 2));


svg = d3.select("svg")
 .append("svg")
 .attr("width", "100%")
 .attr("height", "100%")
 .call(d3.zoom().on("zoom", function () {
    svg.attr("transform", d3.event.transform)
 }))
 .append("g")


function dragstarted(d) {
  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

function dragended(d) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}

function getColorIndex(senderID, list){
  if(list.find(function (obj) { return obj.source === senderID;}) == null)
    return 0;

  else
    return colorPlaces.indexOf((list.find(function (obj) { return obj.source === senderID; })).location);
}

function onSlide() {
  document.getElementById("output").value = document.getElementById("slider").value;
}

function newForceGraph(){
  onSlide();
  fg.updateForceGraph();
}


</script>